name: CI
on:
  push:
    branches:
      - "main"
    tags: ["*"]
env:
  ROOT_DOMAIN: strn.pl
jobs:
  cicd:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v2
        with:
          node-version: '16'

      - name: Build and Commit
        env:
          STATIC_ORIGIN: https://strn.network
          L1_ORIGIN: https://l1s.strn.pl
          TRUSTED_L1_ORIGIN: https://strn.pl
          UNTRUSTED_L1_ORIGIN: https://rings.strn.pl
          LOG_INGESTOR_URL: https://twb3qukm2i654i3tnvx36char40aymqq.lambda-url.us-west-2.on.aws
        run: |
          npm ci
          npm run build

      - uses: EndBug/add-and-commit@v9
        if: github.ref_type == 'tag'
        with:
          add: 'dist'
          default_author: user_info
          message: 'auto build'

      - name: Trigger ./dist/* file replication in filecoin-saturn/homepage repo
        if: github.ref_type == 'tag'
        run: |
          curl \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{secrets.ACCESS_TOKEN}}" \
          https://api.github.com/repos/filecoin-saturn/homepage/actions/workflows/copy-retrieval-client-files.yml/dispatches \
          -d '{"ref": "main"}'
